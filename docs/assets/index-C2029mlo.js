(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const E="6671f55f078a9782a57acf368371a49e";console.log("Using API Key:",E);const w="https://api.themoviedb.org/3";async function B(e=1,o=""){const t=new URLSearchParams({api_key:"6671f55f078a9782a57acf368371a49e",page:e,sort_by:o||"popularity.desc"});return(await(await fetch(`https://api.themoviedb.org/3/discover/movie?${t}`)).json()).results||[]}async function M(e){const o=`${w}/search/movie?api_key=${E}&language=nl-BE&query=${encodeURIComponent(e)}`;try{const t=await fetch(o);if(!t.ok)throw new Error(`HTTP ${t.status}`);return(await t.json()).results}catch(t){return console.error("Fout bij zoeken naar films:",t),[]}}async function S(){const e=`${w}/genre/movie/list?api_key=${E}&language=nl-BE`;try{const o=await fetch(e);if(!o.ok)throw new Error(`HTTP ${o.status}`);return(await o.json()).genres}catch(o){return console.error("Fout bij ophalen genres:",o),[]}}async function $(e,o,t="",n={},r=1){const a=new URLSearchParams({api_key:"6671f55f078a9782a57acf368371a49e",with_genres:e||"",primary_release_year:o||"",sort_by:t||"popularity.desc",page:r});return n.release_date_gte&&a.set("release_date.gte",n.release_date_gte),n.release_date_lte&&a.set("release_date.lte",n.release_date_lte),(await(await fetch(`https://api.themoviedb.org/3/discover/movie?${a}`)).json()).results||[]}function P(e,o=300){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>e(...n),o)}}const T="6671f55f078a9782a57acf368371a49e";console.log("API key:",T);const L="https://image.tmdb.org/t/p/w300";document.getElementById("app");const m=document.getElementById("movie-list");let g=[],l=JSON.parse(localStorage.getItem("favorites"))||[];function f(){return document.getElementById("favorites-toggle").checked}let y=1;async function h(){try{const e=await B(y);if(!e.length){console.warn("No movies returned from the API."),m.innerHTML="<p>No movies available at the moment.</p>";return}g=e,u(e),document.getElementById("load-more").classList.remove("hidden")}catch(e){console.error("Error fetching popular movies:",e),m.innerHTML="<p>Sorry, something went wrong while loading the movies.</p>"}}async function j(){if(!f())try{y++;const e=document.getElementById("sort-dropdown").value||"release_date.desc",o=document.getElementById("genre-filter").value,t=document.getElementById("year-filter").value,n={},r=new Date().toISOString().split("T")[0];i==="unreleased"?(n.release_date_gte=r,e="release_date.asc"):i==="released"&&(n.release_date_lte=r,e="release_date.desc");const s=(await $(o,t,e,n,y)).filter(c=>!g.some(d=>d.id===c.id));if(!s.length){console.warn("No more unique movies to load."),document.getElementById("load-more").classList.add("hidden");return}u(s,!0)}catch(e){console.error("Error loading more movies:",e)}}B().then(e=>{console.log("Populaire films:",e)});function u(e,o=!1){o||(m.innerHTML="",g=[]),g=[...g,...e];const t=document.getElementById("favorites-empty-message");f()&&l.length===0?t&&(t.style.display=""):t&&(t.style.display="none"),e.forEach(n=>{const r=document.createElement("div");r.className="movie-card";const a=l.some(c=>c.id===n.id);r.innerHTML=`
      <button class="favorite-btn${a?" active":""}" aria-label="Voeg toe aan favorieten">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <polygon points="12,2 15,9 22,9.5 17,14.5 18.5,22 12,18 5.5,22 7,14.5 2,9.5 9,9"/>
        </svg>
      </button>
      <img
        src="${n.poster_path?L+n.poster_path:"/fallback.jpg"}"
        alt="${n.title} poster"
        loading="lazy"
      />
      <h3>${n.title}</h3>
      <p><strong>Release Date:</strong> ${n.release_date||"Unknown"}</p>
      <p><strong>Rating:</strong> ${n.vote_average?n.vote_average.toFixed(1):"N/A"}</p>
    `;const s=r.querySelector(".favorite-btn");s.addEventListener("click",c=>{c.stopPropagation(),N(n),s.classList.toggle("active",l.some(d=>d.id===n.id)),f()&&u(l)}),r.addEventListener("click",()=>C(n)),m.appendChild(r)})}function C(e){const o=document.getElementById("overlay"),t=document.getElementById("overlay-details"),n=e.overview||"Geen beschrijving beschikbaar.";t.innerHTML=`
    <img
      src="${e.poster_path?L+e.poster_path:"/fallback.jpg"}"
      alt="${e.title} poster"
      loading="lazy"
    />
    <h2>${e.title}</h2>
    <p><strong>Release Date:</strong> ${e.release_date||"Unknown"}</p>
    <p><strong>Rating:</strong> ${e.vote_average||"N/A"}</p>
    <p>${n}</p>
  `,o.classList.remove("hidden")}function b(){document.getElementById("overlay").classList.add("hidden")}document.getElementById("overlay").addEventListener("click",e=>{e.target.id==="overlay"&&b()});document.getElementById("close-overlay").addEventListener("click",b);document.getElementById("theme-toggle");document.getElementById("theme-toggle-label").addEventListener("click",()=>{const e=document.body.classList.toggle("dark");localStorage.setItem("theme",e?"dark":"light"),document.getElementById("theme-toggle-label").textContent=e?"Lichter thema":"Donker thema"});localStorage.getItem("theme")==="dark"?(document.body.classList.add("dark"),document.getElementById("theme-toggle-label").textContent="Lichter thema"):(document.body.classList.remove("dark"),document.getElementById("theme-toggle-label").textContent="Donker thema");h();const A=document.getElementById("search"),D=P(async e=>{const o=e.target.value.trim();if(!o)return h();try{const t=await M(o);u(t)}catch(t){console.error("Error during search:",t),m.innerHTML="<p>Sorry, something went wrong while searching for movies.</p>"}},300);A.addEventListener("input",D);async function O(){const e=document.getElementById("genre-filter");try{(await S()).forEach(t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.appendChild(n)})}catch(o){console.error("Fout bij laden van genres:",o)}}document.getElementById("apply-filters").addEventListener("click",k);document.getElementById("reset-filters").addEventListener("click",()=>{document.getElementById("genre-filter").value="",document.getElementById("year-filter").value="",document.getElementById("status-toggle").textContent="All",i="all",document.getElementById("sort-dropdown").value="",h()});const p=document.getElementById("status-toggle");let i="all";p.addEventListener("click",()=>{i==="all"?(i="released",p.textContent="Released"):i==="released"?(i="unreleased",p.textContent="Unreleased"):(i="all",p.textContent="All")});async function k(){const e=document.getElementById("genre-filter").value,o=document.getElementById("year-filter").value;let t=document.getElementById("sort-dropdown").value||"release_date.desc";const n={},r=new Date().toISOString().split("T")[0];i==="unreleased"?(n.release_date_gte=new Date(new Date().setDate(new Date().getDate()+1)).toISOString().split("T")[0],t="release_date.asc"):i==="released"&&(n.release_date_lte=r,t="release_date.desc"),o&&(n.primary_release_year=o);try{y=1,I(!0),g=await x(e,o,t,n),u(g),document.getElementById("load-more").classList.remove("hidden")}catch(a){console.error("Fout bij toepassen van filters:",a),m.innerHTML="<p>Sorry, er ging iets mis bij het toepassen van de filters.</p>"}finally{I(!1)}}async function x(e,o,t,n){let r=[],a=1,s=!0;const c=5;for(;s&&a<=c;){const d=new URLSearchParams({api_key:"6671f55f078a9782a57acf368371a49e",with_genres:e||"",sort_by:t||"popularity.desc",page:a});n.release_date_gte&&d.set("release_date.gte",n.release_date_gte),n.release_date_lte&&d.set("release_date.lte",n.release_date_lte),n.primary_release_year&&d.set("primary_release_year",n.primary_release_year);const v=await fetch(`https://api.themoviedb.org/3/discover/movie?${d}`);if(!v.ok)throw new Error(`Fout bij ophalen films: ${v.status}`);const _=await v.json();_.results.length===0?s=!1:(r=[...r,..._.results],a++)}return r}function I(e){const o=document.getElementById("loading-indicator");if(e){if(!o){const t=document.createElement("div");t.id="loading-indicator",t.textContent="Laden...",t.style.textAlign="center",t.style.margin="1rem 0",m.appendChild(t)}}else{const t=document.getElementById("loading-indicator");t&&t.remove()}}function N(e){const o=l.findIndex(t=>t.id===e.id);o===-1?l.push(e):l.splice(o,1),localStorage.setItem("favorites",JSON.stringify(l)),f()&&u(l)}document.getElementById("favorites-toggle").addEventListener("change",()=>{const e=document.getElementById("favorites-toggle-label");f()?(u(l),document.getElementById("load-more").classList.add("hidden"),e.textContent="Alle films"):(y=1,h(),e.textContent="Favorieten")});document.getElementById("scroll-top-btn").addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});document.getElementById("sort-dropdown").addEventListener("change",()=>{k()});O();document.getElementById("load-more").addEventListener("click",j);
